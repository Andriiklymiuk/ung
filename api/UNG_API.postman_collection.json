{
	"info": {
		"_postman_id": "ung-api-collection",
		"name": "UNG API Collection",
		"description": "Complete API collection for UNG - Universal Next-Gen Billing & Tracking\n\n## Features\n- Multi-tenant architecture with encrypted databases\n- JWT authentication with refresh tokens\n- Invoice management\n- Time tracking\n- Client and contract management\n\n## Base URL\n`http://localhost:3000/api/v1`\n\n## Authentication\nMost endpoints require JWT authentication. Use the `Authorization` header with `Bearer <token>` format.\n\n## Environment Variables\n- `base_url`: API base URL (default: http://localhost:3000)\n- `api_version`: API version (default: v1)\n- `access_token`: JWT access token (set automatically after login)\n- `refresh_token`: JWT refresh token (set automatically after login)\n- `tenant_id`: Current tenant ID (set automatically after registration/login)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Authentication",
			"description": "User authentication endpoints including registration, login, token refresh, and profile management.",
			"item": [
				{
					"name": "Register User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Store tokens automatically",
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    pm.environment.set('access_token', response.access_token);",
									"    pm.environment.set('refresh_token', response.refresh_token);",
									"    pm.environment.set('tenant_id', response.user.id);",
									"    console.log('✅ Registered successfully. Tokens saved.');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecurePassword123!\",\n  \"name\": \"John Doe\",\n  \"company_name\": \"Acme Inc\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/{{api_version}}/auth/register",
							"host": ["{{base_url}}"],
							"path": ["api", "{{api_version}}", "auth", "register"]
						},
						"description": "Register a new user account. Creates a new tenant with encrypted database.\n\n**Request Body:**\n- `email` (string, required): User email address\n- `password` (string, required): Strong password (min 8 characters)\n- `name` (string, required): Full name\n- `company_name` (string, optional): Company name\n\n**Response:**\n- `access_token`: JWT access token (expires in 15 minutes)\n- `refresh_token`: JWT refresh token (expires in 7 days)\n- `user`: User object with profile information\n\n**Notes:**\n- Password is hashed using bcrypt\n- Tenant database is created and encrypted\n- Tokens are automatically stored in environment variables"
					},
					"response": [
						{
							"name": "Success Response",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecurePassword123!\",\n  \"name\": \"John Doe\",\n  \"company_name\": \"Acme Inc\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{base_url}}/api/{{api_version}}/auth/register",
									"host": ["{{base_url}}"],
									"path": ["api", "{{api_version}}", "auth", "register"]
								}
							},
							"status": "Created",
							"code": 201,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n  \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"user\": {\n    \"id\": \"user_123abc\",\n    \"email\": \"user@example.com\",\n    \"name\": \"John Doe\",\n    \"company_name\": \"Acme Inc\",\n    \"created_at\": \"2024-01-15T10:30:00Z\"\n  }\n}"
						}
					]
				},
				{
					"name": "Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Store tokens automatically",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.environment.set('access_token', response.access_token);",
									"    pm.environment.set('refresh_token', response.refresh_token);",
									"    pm.environment.set('tenant_id', response.user.id);",
									"    console.log('✅ Logged in successfully. Tokens saved.');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecurePassword123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/{{api_version}}/auth/login",
							"host": ["{{base_url}}"],
							"path": ["api", "{{api_version}}", "auth", "login"]
						},
						"description": "Authenticate user and receive JWT tokens.\n\n**Request Body:**\n- `email` (string, required): User email\n- `password` (string, required): User password\n\n**Response:**\n- `access_token`: JWT access token (expires in 15 minutes)\n- `refresh_token`: JWT refresh token (expires in 7 days)\n- `user`: User profile\n\n**Notes:**\n- Tenant database is decrypted and loaded into memory\n- Tokens are JWT signed with HS256"
					},
					"response": []
				},
				{
					"name": "Refresh Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Update access token",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.environment.set('access_token', response.access_token);",
									"    console.log('✅ Token refreshed successfully.');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"refresh_token\": \"{{refresh_token}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/{{api_version}}/auth/refresh",
							"host": ["{{base_url}}"],
							"path": ["api", "{{api_version}}", "auth", "refresh"]
						},
						"description": "Refresh access token using refresh token.\n\n**Request Body:**\n- `refresh_token` (string, required): Valid refresh token\n\n**Response:**\n- `access_token`: New JWT access token\n\n**Notes:**\n- Refresh tokens are valid for 7 days\n- Access tokens expire after 15 minutes\n- Use this endpoint before access token expires"
					},
					"response": []
				},
				{
					"name": "Get Profile",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/{{api_version}}/auth/me",
							"host": ["{{base_url}}"],
							"path": ["api", "{{api_version}}", "auth", "me"]
						},
						"description": "Get current user profile.\n\n**Headers:**\n- `Authorization: Bearer <access_token>`\n\n**Response:**\n- User profile with email, name, company info\n\n**Notes:**\n- Requires valid access token\n- Returns 401 if token expired"
					},
					"response": []
				}
			]
		},
		{
			"name": "Invoices",
			"description": "Invoice management endpoints for creating, viewing, and managing invoices.",
			"item": [
				{
					"name": "List Invoices",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/{{api_version}}/invoices?status=pending&limit=10&offset=0",
							"host": ["{{base_url}}"],
							"path": ["api", "{{api_version}}", "invoices"],
							"query": [
								{
									"key": "status",
									"value": "pending",
									"description": "Filter by status (pending, paid, overdue)"
								},
								{
									"key": "limit",
									"value": "10",
									"description": "Number of results per page"
								},
								{
									"key": "offset",
									"value": "0",
									"description": "Pagination offset"
								}
							]
						},
						"description": "Get list of invoices for the current tenant.\n\n**Query Parameters:**\n- `status` (string): Filter by status (pending, paid, overdue, cancelled)\n- `client_id` (integer): Filter by client ID\n- `from_date` (string): Start date (YYYY-MM-DD)\n- `to_date` (string): End date (YYYY-MM-DD)\n- `limit` (integer): Results per page (default: 50)\n- `offset` (integer): Pagination offset (default: 0)\n\n**Response:**\n- Array of invoice objects\n- Total count\n- Pagination info"
					},
					"response": []
				},
				{
					"name": "Get Invoice by ID",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/{{api_version}}/invoices/1",
							"host": ["{{base_url}}"],
							"path": ["api", "{{api_version}}", "invoices", "1"]
						},
						"description": "Get invoice details by ID.\n\n**Path Parameters:**\n- `id` (integer): Invoice ID\n\n**Response:**\n- Complete invoice object with line items\n- Client details\n- Payment history"
					},
					"response": []
				},
				{
					"name": "Create Invoice",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"invoice_num\": \"INV-2024-001\",\n  \"company_id\": 1,\n  \"client_id\": 1,\n  \"amount\": 1500.00,\n  \"currency\": \"USD\",\n  \"description\": \"Web Development Services - January 2024\",\n  \"due_date\": \"2024-02-15\",\n  \"line_items\": [\n    {\n      \"item_name\": \"Frontend Development\",\n      \"description\": \"React application development\",\n      \"quantity\": 40,\n      \"rate\": 25.00,\n      \"amount\": 1000.00\n    },\n    {\n      \"item_name\": \"Backend API\",\n      \"description\": \"Node.js API development\",\n      \"quantity\": 20,\n      \"rate\": 25.00,\n      \"amount\": 500.00\n    }\n  ],\n  \"notes\": \"Payment due within 30 days\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/{{api_version}}/invoices",
							"host": ["{{base_url}}"],
							"path": ["api", "{{api_version}}", "invoices"]
						},
						"description": "Create a new invoice.\n\n**Request Body:**\n- `invoice_num` (string): Unique invoice number\n- `company_id` (integer): Company ID\n- `client_id` (integer): Client ID\n- `amount` (number): Total amount\n- `currency` (string): Currency code (USD, EUR, etc.)\n- `description` (string): Invoice description\n- `due_date` (string): Due date (YYYY-MM-DD)\n- `line_items` (array): Line items array\n- `notes` (string): Additional notes\n\n**Response:**\n- Created invoice object with ID"
					},
					"response": []
				},
				{
					"name": "Update Invoice",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"status\": \"paid\",\n  \"notes\": \"Payment received via wire transfer\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/{{api_version}}/invoices/1",
							"host": ["{{base_url}}"],
							"path": ["api", "{{api_version}}", "invoices", "1"]
						},
						"description": "Update invoice details.\n\n**Path Parameters:**\n- `id` (integer): Invoice ID\n\n**Request Body:**\n- Any invoice fields to update\n\n**Response:**\n- Updated invoice object"
					},
					"response": []
				},
				{
					"name": "Delete Invoice",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/{{api_version}}/invoices/1",
							"host": ["{{base_url}}"],
							"path": ["api", "{{api_version}}", "invoices", "1"]
						},
						"description": "Delete an invoice.\n\n**Path Parameters:**\n- `id` (integer): Invoice ID\n\n**Response:**\n- Success message"
					},
					"response": []
				},
				{
					"name": "Email Invoice",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"to\": [\"client@example.com\"],\n  \"cc\": [\"accounting@example.com\"],\n  \"subject\": \"Invoice #INV-2024-001\",\n  \"message\": \"Please find attached your invoice for services rendered.\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/{{api_version}}/invoices/1/email",
							"host": ["{{base_url}}"],
							"path": ["api", "{{api_version}}", "invoices", "1", "email"]
						},
						"description": "Send invoice via email.\n\n**Path Parameters:**\n- `id` (integer): Invoice ID\n\n**Request Body:**\n- `to` (array): Recipient email addresses\n- `cc` (array, optional): CC recipients\n- `subject` (string): Email subject\n- `message` (string): Email body\n\n**Response:**\n- Success message with email status"
					},
					"response": []
				}
			]
		},
		{
			"name": "Health Check",
			"description": "System health and status endpoints.",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/health",
							"host": ["{{base_url}}"],
							"path": ["health"]
						},
						"description": "Check if API is running and healthy.\n\n**Response:**\n- Status message\n\n**Notes:**\n- No authentication required\n- Used for monitoring and load balancers"
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Auto-refresh token if expired",
					"const accessToken = pm.environment.get('access_token');",
					"const refreshToken = pm.environment.get('refresh_token');",
					"",
					"if (accessToken && refreshToken) {",
					"    // Check if token might be expired (simple check)",
					"    // In production, decode JWT and check exp claim",
					"    console.log('Using access token from environment');",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global test scripts",
					"pm.test('Response time is acceptable', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(2000);",
					"});",
					"",
					"if (pm.response.code !== 401 && pm.response.code !== 404) {",
					"    pm.test('Response has correct content type', function () {",
					"        pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
					"    });",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "api_version",
			"value": "v1",
			"type": "string"
		}
	]
}
